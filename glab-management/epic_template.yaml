# GitLab Epic and Issues Template
# Use this template to define an epic and its associated issues
#
# IMPORTANT: Focus on WHAT needs to be done, not HOW to do it
# - Tell outcomes, not implementation details
# - Keep descriptions concise (2-4 sentences)
# - Acceptance criteria should be measurable outcomes (3-5 bullets max)
# - No code snippets, function names, or implementation guidance
#
# Task Structure Rules:
# - [Impl] tasks MUST include "Unit tests added and passing" in acceptance criteria
# - [Design] tasks MUST include "Design document created" in acceptance criteria
# - [Test] tasks are for integration/system tests only (NOT unit tests)
# - Documentation is part of [Design], not a separate final step
#
# Labels:
# - IMPORTANT: All labels are validated against allowed_labels in the glab_config.yaml used by glab_tasks_management.py
# - Always check your glab_config.yaml for the current list of allowed labels
# - Using labels not in the config will cause validation errors
# - Standard labels pattern (check config for exact values):
#   - One type:: label (e.g., type::feature, type::bug)
#   - One development-status:: label (e.g., development-status::backlog)
#   - One product/vertical:: label (e.g., product/vertical::undefined, product/vertical::ctkv)
# - Special labels (check config):
#   - "Architecture & Research" - for research/design tasks
#   - "integration-tests" - for integration/system test tasks
# - Component labels (check config for available options)
#
# See glab_tasks_management.py help output for the supported YAML format and validation rules

# Epic configuration
# Option 1: Create a new epic
epic:
  title: "Q1 2025 Video Processing Improvements"
  description: |
    This epic tracks improvements to the video processing pipeline including:
    - Performance optimizations
    - Memory usage reduction
    - Enhanced error handling
    - Better logging and monitoring

# Option 2: Use an existing epic (comment out the above and uncomment below)
# epic:
#   id: 123  # Existing epic ID from GitLab

# Issues to create and link to the epic
issues:
  # ============================================
  # RESEARCH TASKS
  # ============================================

  - id: research-h265-profiling
    title: "[Research] Profile H.265 encoding performance on Rockchip RK3588"
    description: |
      # Description

      Current H.265 encoding shows suboptimal performance. Profile the implementation to identify bottlenecks and establish baseline metrics before optimization.

      # Acceptance Criteria

      - Baseline metrics documented: encoding latency, CPU usage, memory usage
      - Performance bottlenecks identified and prioritized
      - Optimization recommendations provided
    labels:
      - "type::feature"
      - "development-status::backlog"
      - "product/vertical::undefined"
      - "Architecture & Research"
      - "video-encoding"

  # ============================================
  # DESIGN TASKS
  # ============================================

  - id: design-optimization-strategy
    title: "[Design] Define optimization strategy for H.265 encoder"
    description: |
      # Description

      Create design document outlining H.265 encoder optimization strategy based on profiling results.

      # Acceptance Criteria

      - Design document created with optimization approach
      - Target performance metrics defined
      - Risk assessment completed
      - Team review and approval obtained
    labels:
      - "type::feature"
      - "development-status::backlog"
      - "product/vertical::undefined"
      - "Architecture & Research"
      - "video-encoding"
    dependencies:
      - research-h265-profiling

  # ============================================
  # IMPLEMENTATION TASKS
  # ============================================

  - id: impl-buffer-optimization
    title: "[Impl] Optimize buffer management in RKMPP encoder"
    description: |
      # Description

      Implement buffer management optimizations to achieve low-latency encoding.

      # Acceptance Criteria

      - Memory allocation reduced during steady-state operation
      - No memory leaks (verified with ASAN)
      - Performance improvement measured and documented
      - Unit tests added and passing
      - Code passes clang-tidy checks
    labels:
      - "type::feature"
      - "development-status::backlog"
      - "product/vertical::undefined"
      - "video-encoding"
    dependencies:
      - design-optimization-strategy

  - id: impl-memory-leak-fix
    title: "[Impl] Fix memory leak in loggerd during long recording sessions"
    description: |
      # Description

      Memory usage grows unbounded during recording sessions longer than 4 hours, causing system instability.

      # Acceptance Criteria

      - Root cause identified and fixed
      - Memory usage stable over 8+ hour recording session
      - Unit tests added and passing
      - ASAN tests pass with no memory errors
    labels:
      - "type::bug"
      - "development-status::backlog"
      - "product/vertical::undefined"

  - id: impl-vbr-encoding
    title: "[Impl] Add support for variable bitrate encoding"
    description: |
      # Description

      Add VBR encoding mode to optimize storage usage while maintaining quality.

      # Acceptance Criteria

      - VBR mode configurable via camera config
      - Storage savings measured and documented
      - Quality comparison with CBR documented
      - Unit tests added and passing
    labels:
      - "type::feature"
      - "development-status::backlog"
      - "product/vertical::undefined"

  # ============================================
  # TESTING TASKS (Integration/System tests only - unit tests are part of [Impl])
  # ============================================

  - id: test-performance-regression
    title: "[Test] Create performance regression tests for encoder"
    description: |
      # Description

      Develop automated performance tests to catch encoder regressions in CI.

      # Acceptance Criteria

      - Performance test framework established
      - Tests measure encoding latency, throughput, CPU usage
      - Tests fail if metrics regress beyond threshold
      - Integrated with CI pipeline
    labels:
      - "type::feature"
      - "development-status::backlog"
      - "product/vertical::undefined"
      - "integration-tests"
      - "video-encoding"
    dependencies:
      - impl-buffer-optimization
      - impl-vbr-encoding
